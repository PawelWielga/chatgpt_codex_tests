import{u as V,r as n,j as R}from"./index-UO3WNEwl.js";const X=24,Z=32,J=24,ee=8,te="#101418",ne="rgba(255,255,255,0.05)",se="#4caf50",re="#81c784",oe="#d9534f",ce=10,ae=1e3,ue=1,ie=100,fe=1,O="right",U=[{x:3,y:5},{x:2,y:5},{x:1,y:5}],le={x:10,y:10},de=new Set([" ","p"]),he={arrowup:"up",w:"up",arrowdown:"down",s:"down",arrowleft:"left",a:"left",arrowright:"right",d:"right"},b={up:{x:0,y:-1},down:{x:0,y:1},left:{x:-1,y:0},right:{x:1,y:0}};function H(c,u){return(c+u)%u}function B(c,u){return Math.floor(u()*c)}function j(c,u,d,f){const l=new Set(d.map(t=>`${t.x},${t.y}`));for(let t=0;t<ie;t++){const a={x:B(c,f),y:B(u,f)};if(!l.has(`${a.x},${a.y}`))return a}for(let t=0;t<u;t++)for(let a=0;a<c;a++)if(!l.has(`${a},${t}`))return{x:a,y:t};return{x:0,y:0}}function Re(c,u,d){if(!c.alive)return c;const f=b[u],l={x:H(c.snake[0].x+f.x,d.cols),y:H(c.snake[0].y+f.y,d.rows)},t=[l,...c.snake],a=l.x===c.food.x&&l.y===c.food.y;let x=c.food,h=c.score;a?(h+=ce,x=j(d.cols,d.rows,t,d.rng)):t.pop();const y=t.slice(1).some(m=>m.x===l.x&&m.y===l.y);return{snake:t,dir:f,food:x,score:h,alive:!y}}function we(){const{settings:c}=V(),u=n.useMemo(()=>{switch(c.difficulty){case"easy":return 8;case"hard":return 14;default:return 10}},[c.difficulty]),d=n.useRef(null),[f,l]=n.useState(0),t={size:X,cols:Z,rows:J},[a,x]=n.useState(O),h=n.useRef([]),[y,m]=n.useState(!0),[g,D]=n.useState(!1),F=n.useRef(Date.now()>>>0),v=n.useRef(Math.random),M=n.useCallback(e=>{let r=(e??F.current)||1;v.current=()=>(r^=r<<13,r^=r>>>17,r^=r<<5,(r>>>0)/4294967295),F.current=r>>>0},[]),[I,A]=n.useState(()=>({snake:U,dir:b[O],food:le,score:0,alive:!0}));n.useEffect(()=>{A(e=>({...e,food:j(t.cols,t.rows,e.snake,v.current)}))},[]),n.useEffect(()=>{const e=r=>{const w=r.key.toLowerCase();if(de.has(w)){D(S=>!S);return}const i=he[w];if(!i)return;const s=h.current.length?h.current[h.current.length-1]:a;s==="up"&&i==="down"||s==="down"&&i==="up"||s==="left"&&i==="right"||s==="right"&&i==="left"||h.current.push(i)};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[a]);function N(e,r,w,i,s){const k=w*s,S=i*s;e.fillStyle=te,e.fillRect(0,0,k,S),e.strokeStyle=ne,e.lineWidth=ue;for(let o=0;o<=w;o++)e.beginPath(),e.moveTo(o*s+.5,0),e.lineTo(o*s+.5,S),e.stroke();for(let o=0;o<=i;o++)e.beginPath(),e.moveTo(0,o*s+.5),e.lineTo(k,o*s+.5),e.stroke();e.fillStyle=oe,e.fillRect(r.food.x*s,r.food.y*s,s,s);for(let o=0;o<r.snake.length;o++){const p=r.snake[o];e.fillStyle=o===0?se:re,e.fillRect(p.x*s,p.y*s,s,s)}}const E=n.useRef(I),P=n.useRef(a),T=n.useRef(y),K=n.useRef(f),C=n.useRef(t.size);n.useEffect(()=>{E.current=I},[I]),n.useEffect(()=>{P.current=a},[a]),n.useEffect(()=>{T.current=y},[y]),n.useEffect(()=>{K.current=f},[f]);const _=n.useRef(null),$=n.useRef(0);n.useEffect(()=>{const e=d.current,r=e?.getContext("2d");if(!r||!e)return;const w=ae/u,i=()=>{const o=e.parentElement;if(!o)return;const p=o.clientWidth,z=o.clientHeight,q=Math.floor(p/t.cols),Q=Math.floor(z/t.rows),L=Math.max(ee,Math.min(q,Q)),W=t.cols*L,G=t.rows*L;e.width=W,e.height=G,e.style.width=`${W}px`,e.style.height=`${G}px`,C.current=L},s=new ResizeObserver(i),k=e.parentElement;k&&s.observe(k),i();const S=o=>{if(_.current=requestAnimationFrame(S),!T.current||g){N(r,E.current,t.cols,t.rows,C.current);return}if(o-$.current>=w){$.current=o;for(let p=0;p<fe&&h.current.length;p++)x(h.current.shift());A(p=>Re(p,P.current,{cols:t.cols,rows:t.rows,rng:v.current}))}N(r,E.current,t.cols,t.rows,C.current),E.current.score!==K.current&&l(E.current.score),!E.current.alive&&T.current&&m(!1)};return _.current=requestAnimationFrame(S),()=>{_.current&&cancelAnimationFrame(_.current),s.disconnect()}},[u,g,t.cols,t.rows]);const Y=n.useCallback(()=>{h.current=[],x(O),m(!0),D(!1),l(0),M();const e=U,r=j(t.cols,t.rows,e,v.current);A({snake:e,dir:b[O],food:r,score:0,alive:!0})},[t.cols,t.rows,M]);return R.jsxs("div",{className:"snake-root",role:"group","aria-label":"Snake",children:[R.jsxs("div",{className:"snake-hud",children:[R.jsxs("span",{children:["Score: ",f]}),R.jsxs("span",{children:["Speed: ",u]}),R.jsx("button",{onClick:()=>D(e=>!e),children:g?"Resume":"Pause"}),R.jsx("button",{onClick:Y,children:"Restart"}),!y&&R.jsx("span",{className:"dead",children:"Game Over"})]}),R.jsx("div",{className:"snake-canvas-wrap",children:R.jsx("canvas",{ref:d,"aria-label":"Snake canvas"})}),R.jsx("div",{className:"snake-help",children:"Arrows / WASD to steer. Space to pause."})]})}export{we as default};
