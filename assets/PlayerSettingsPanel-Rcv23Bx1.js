import{r as a,j as e}from"./index-UO3WNEwl.js";import{usePlayerSettings as B}from"./PlayerSettingsContext-eR9fecty.js";function O(d,s,i){a.useEffect(()=>{if(!d)return;const m=s.current;if(!m)return;const y=()=>Array.from(m.querySelectorAll('a[href],button:not([disabled]),input:not([disabled]),select:not([disabled]),textarea:not([disabled]),[tabindex]:not([tabindex="-1"])')),r=()=>{if(i){const n=m.querySelector(i);if(n)return n.focus(),!0}const l=y()[0];return l&&l.focus(),!!l},N=l=>{if(l.key!=="Tab")return;const n=y();if(n.length===0)return;const p=n[0],x=n[n.length-1];l.shiftKey?document.activeElement===p&&(l.preventDefault(),x.focus()):document.activeElement===x&&(l.preventDefault(),p.focus())},h=document.activeElement,A=()=>{h&&typeof h.focus=="function"&&h.focus()};document.addEventListener("keydown",N);const k=window.setTimeout(()=>r(),20);return()=>{window.clearTimeout(k),document.removeEventListener("keydown",N),A()}},[d,s,i])}function G(d){const{open:s,onClose:i,variant:m="modal",initialFocusSelector:y}=d,{settings:r,setName:N,setColor:h,setEmoji:A,setAiColor:k,setAiEmoji:l,reset:n}=B(),p=a.useId(),x=a.useId(),f=a.useRef(null),c=m==="modal"||m==="drawer";O(s&&c,f,y),a.useEffect(()=>{if(!s||!c)return;const t=u=>{u.key==="Escape"&&i()},b=u=>{f.current&&u.target instanceof Node&&f.current===u.target&&i()};return window.addEventListener("keydown",t),f.current?.addEventListener("pointerdown",b),()=>{window.removeEventListener("keydown",t),f.current?.removeEventListener("pointerdown",b)}},[s,c,i]);const[g,L]=a.useState(r.name),[j,S]=a.useState(r.color),[C,T]=a.useState(r.emoji),[v,P]=a.useState(r.aiColor),[E,D]=a.useState(r.aiEmoji);a.useEffect(()=>{s&&(L(r.name),S(r.color),T(r.emoji),P(r.aiColor),D(r.aiEmoji))},[s,r]);const o=a.useMemo(()=>{const t={name:null,color:null,emoji:null,aiColor:null,aiEmoji:null};g.trim()||(t.name="Name cannot be empty.");const b=/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/;b.test(j.trim())||(t.color="Color must be a hex value like #dc3545 or #fff."),b.test(v.trim())||(t.aiColor="AI color must be a hex value like #ffc107 or #ff0.");const u=I=>I.trim().length>0&&I.trim().length<=4&&!/[<>{}]/.test(I);return u(C)||(t.emoji="Provide a valid emoji."),u(E)||(t.aiEmoji="Provide a valid emoji."),t},[g,j,C,v,E]),K=Object.values(o).some(Boolean),M=t=>{t.preventDefault(),!K&&(N(g.trim()),h(j.trim()),A(C.trim()),k(v.trim()),l(E.trim()),$("Player settings saved"),c&&i())},q=()=>{n(),$("Player settings reset"),c&&i()};if(!s&&c)return null;const R=e.jsx("div",{className:["ps-panel",`ps-${m}`].join(" "),role:c?"dialog":"region","aria-modal":c?!0:void 0,"aria-labelledby":p,"aria-describedby":x,ref:f,children:e.jsxs("div",{className:"ps-surface",role:"document",onPointerDown:t=>t.stopPropagation(),children:[e.jsxs("header",{className:"ps-header",children:[e.jsx("h2",{id:p,className:"ps-title",children:"Player Settings"}),e.jsx("button",{className:"ps-close",type:"button","aria-label":"Close settings",title:"Close",onClick:i,children:"Ã—"})]}),e.jsx("div",{id:x,className:"ps-desc",children:"Customize your name, colors, and emoji for you and AI."}),e.jsxs("form",{className:"ps-form",onSubmit:M,children:[e.jsxs("section",{className:"ps-section","aria-labelledby":"ps-user",children:[e.jsx("h3",{id:"ps-user",className:"ps-section-title",children:"You"}),e.jsxs("div",{className:"ps-field",children:[e.jsx("label",{htmlFor:"ps-name",children:"Name"}),e.jsx("input",{id:"ps-name",type:"text",value:g,onChange:t=>L(t.target.value),maxLength:40,"aria-invalid":!!o.name,"aria-describedby":o.name?"ps-name-err":void 0}),o.name&&e.jsx("div",{id:"ps-name-err",className:"ps-error",role:"alert",children:o.name})]}),e.jsxs("div",{className:"ps-field",children:[e.jsx("label",{htmlFor:"ps-color",children:"Color"}),e.jsxs("div",{className:"ps-color-row",children:[e.jsx("input",{id:"ps-color",type:"text",inputMode:"text",placeholder:"#dc3545",value:j,onChange:t=>S(t.target.value),"aria-invalid":!!o.color,"aria-describedby":o.color?"ps-color-err":void 0}),e.jsx("input",{"aria-label":"Pick color",title:"Pick color",className:"ps-color",type:"color",value:w(j),onChange:t=>S(t.target.value)}),e.jsx("div",{className:"ps-swatch",style:{background:w(j)},"aria-hidden":!0})]}),o.color&&e.jsx("div",{id:"ps-color-err",className:"ps-error",role:"alert",children:o.color})]}),e.jsxs("div",{className:"ps-field",children:[e.jsx("label",{htmlFor:"ps-emoji",children:"Emoji"}),e.jsx("input",{id:"ps-emoji",type:"text",value:C,onChange:t=>T(t.target.value),"aria-invalid":!!o.emoji,"aria-describedby":o.emoji?"ps-emoji-err":void 0}),o.emoji&&e.jsx("div",{id:"ps-emoji-err",className:"ps-error",role:"alert",children:o.emoji})]})]}),e.jsxs("section",{className:"ps-section","aria-labelledby":"ps-ai",children:[e.jsx("h3",{id:"ps-ai",className:"ps-section-title",children:"AI Opponent"}),e.jsxs("div",{className:"ps-field",children:[e.jsx("label",{htmlFor:"ps-ai-color",children:"AI Color"}),e.jsxs("div",{className:"ps-color-row",children:[e.jsx("input",{id:"ps-ai-color",type:"text",placeholder:"#ffc107",value:v,onChange:t=>P(t.target.value),"aria-invalid":!!o.aiColor,"aria-describedby":o.aiColor?"ps-ai-color-err":void 0}),e.jsx("input",{"aria-label":"Pick AI color",title:"Pick AI color",className:"ps-color",type:"color",value:w(v),onChange:t=>P(t.target.value)}),e.jsx("div",{className:"ps-swatch",style:{background:w(v)},"aria-hidden":!0})]}),o.aiColor&&e.jsx("div",{id:"ps-ai-color-err",className:"ps-error",role:"alert",children:o.aiColor})]}),e.jsxs("div",{className:"ps-field",children:[e.jsx("label",{htmlFor:"ps-ai-emoji",children:"AI Emoji"}),e.jsx("input",{id:"ps-ai-emoji",type:"text",value:E,onChange:t=>D(t.target.value),"aria-invalid":!!o.aiEmoji,"aria-describedby":o.aiEmoji?"ps-ai-emoji-err":void 0}),o.aiEmoji&&e.jsx("div",{id:"ps-ai-emoji-err",className:"ps-error",role:"alert",children:o.aiEmoji})]})]}),e.jsxs("div",{className:"ps-actions",children:[e.jsx("button",{type:"submit",className:"ps-primary",children:"Save"}),e.jsx("button",{type:"button",className:"ps-secondary",onClick:q,children:"Reset"})]})]})]})});return c?R:e.jsx("div",{className:"ps-inline-wrapper",role:"region","aria-labelledby":p,children:R})}function w(d){const s=d.trim();return/^#[0-9a-fA-F]{3}$/.test(s)?"#"+s.slice(1).split("").map(i=>i+i).join("").toLowerCase():/^#[0-9a-fA-F]{6}$/.test(s)?s.toLowerCase():"#000000"}let F;function $(d){let s=document.getElementById("ps-toast");s||(s=document.createElement("div"),s.id="ps-toast",s.setAttribute("role","status"),s.setAttribute("aria-live","polite"),document.body.appendChild(s)),s.textContent=d,s.className="ps-toast ps-toast-show",F&&window.clearTimeout(F),F=window.setTimeout(()=>{s?.classList.remove("ps-toast-show")},1800)}export{G as default};
