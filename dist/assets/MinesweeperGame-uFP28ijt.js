import{r as m,j}from"./index-UO3WNEwl.js";const K={cols:9,rows:9,mines:10},O=1e3,Q=999,_=28,F=60;function Z(t,n,u,f){return t>=0&&t<u&&n>=0&&n<f}function D(t,n,u){const f=Math.floor(t/n),r=t%n,g=[];for(let o=f-1;o<=f+1;o++)for(let a=r-1;a<=r+1;a++)o===f&&a===r||Z(a,o,n,u)&&g.push(o*n+a);return g}function W(t,n){return Array.from({length:t*n},()=>({mine:!1,revealed:!1,flagged:!1,adj:0}))}function ee(t,n,u,f,r,g){const o=new Set([r,...D(r,n,u)]);let a=0;for(;a<f;){const d=Math.floor(g()*t.length);o.has(d)||t[d].mine||(t[d].mine=!0,a++)}for(let d=0;d<t.length;d++){if(t[d].mine)continue;const p=D(d,n,u).reduce((S,E)=>S+(t[E].mine?1:0),0);t[d].adj=p}}function te(t,n,u,f){const r=[n];for(;r.length;){const g=r.pop(),o=t[g];if(!(o.revealed||o.flagged)&&(o.revealed=!0,!o.mine&&o.adj===0))for(const a of D(g,u,f))!t[a].revealed&&!t[a].flagged&&r.push(a)}}function ne(t,n,u,f){const r=new Map;if(!t.size)return r;const g=t.has(n)?n:[...t][0];r.set(g,0);const o=[g];for(;o.length;){const a=o.shift(),d=r.get(a);for(const p of D(a,u,f))t.has(p)&&(r.has(p)||(r.set(p,d+1),o.push(p)))}return r}function re(){const{cols:t,rows:n,mines:u}=K,f=m.useRef(Date.now()>>>0),r=m.useRef(Math.random),g=()=>{let e=f.current||1;r.current=function(){return e^=e<<13,e^=e>>>17,e^=e<<5,(e>>>0)%4294967295/4294967295}},[o,a]=m.useState(()=>W(t,n)),[d,p]=m.useState(!1),[S,E]=m.useState(!1),[R,C]=m.useState(!1),[L,y]=m.useState(0),[$,N]=m.useState(0),w=m.useRef(null),[z,T]=m.useState(()=>Array(t*n).fill(null)),k=m.useRef(0),P=m.useMemo(()=>Math.max(0,u-L),[u,L]);m.useEffect(()=>{g()},[]),m.useEffect(()=>(d&&!S&&!R&&(w.current=window.setInterval(()=>N(e=>Math.min(Q,e+1)),O)),()=>{w.current&&(window.clearInterval(w.current),w.current=null)}),[d,S,R]);const B=()=>{w.current&&window.clearInterval(w.current),f.current=f.current*1664525+1013904223>>>0,g(),a(W(t,n)),p(!1),E(!1),C(!1),y(0),N(0),T(Array(t*n).fill(null)),k.current=0},U=e=>{const l=t*n;let s=0,v=0;for(let i=0;i<l;i++){const h=e[i];h.mine?v++:h.revealed&&s++}v===u&&s===l-u&&(w.current&&window.clearInterval(w.current),C(!0))},X=e=>{S||R||a(l=>{const s=l.map(c=>({...c})),v=s[e];if(v.revealed||v.flagged)return l;if(d||(ee(s,t,n,u,e,r.current),p(!0)),s[e].mine){s[e].revealed=!0;for(let c=0;c<s.length;c++)s[c].mine&&(s[c].revealed=!0);return E(!0),w.current&&window.clearInterval(w.current),T(Array(t*n).fill(null)),s}const i=s.map(c=>({...c}));i[e].adj===0?te(i,e,t,n):i[e].revealed=!0;const h=new Set;for(let c=0;c<i.length;c++)i[c].revealed&&!l[c].revealed&&!i[c].mine&&h.add(c);if(h.size===0)return s;const I=ne(h,e,t,n),A=++k.current;T(Array(t*n).fill(null)),I.forEach((c,x)=>{window.setTimeout(()=>{a(b=>{const M=b.map(J=>({...J}));return!M[x].mine&&!M[x].revealed&&!M[x].flagged&&(M[x].revealed=!0),M}),T(b=>{const M=b.slice();return M[x]={waveId:A,dist:c},M})},c*F)});const H=Math.max(0,...I.values());return window.setTimeout(()=>U(i),H*F+5),s})},q=e=>{S||R||a(l=>{const s=l.map(i=>({...i})),v=s[e];return v.revealed?l:(v.flagged?(v.flagged=!1,y(i=>Math.max(0,i-1))):(v.flagged=!0,y(i=>i+1)),s)})},G=(e,l)=>{e.button===2?(e.preventDefault(),q(l)):e.button===0&&X(l)},V=e=>{e.preventDefault()},Y={gridTemplateColumns:`repeat(${t}, ${_}px)`,gridTemplateRows:`repeat(${n}, ${_}px)`};return j.jsxs("div",{className:"ms-root",children:[j.jsxs("div",{className:"ms-header",children:[j.jsx("div",{className:"ms-counter","aria-label":"Mines remaining",children:String(P).padStart(3,"0")}),j.jsx("button",{className:"ms-reset",onClick:B,title:"Restart",children:S?"ðŸ˜µ":R?"ðŸ˜Ž":"ðŸ™‚"}),j.jsx("div",{className:"ms-timer","aria-label":"Timer",children:String($).padStart(3,"0")})]}),j.jsx("div",{className:"ms-grid",style:Y,onContextMenu:V,role:"grid","aria-label":"Minesweeper board",children:o.map((e,l)=>{const s=["ms-cell"];e.revealed&&s.push("revealed"),e.flagged&&s.push("flagged");const v=e.revealed?e.mine?"ðŸ’£":e.adj>0?String(e.adj):"":e.flagged?"ðŸš©":"",i=e.revealed&&!e.mine&&e.adj>0?`n${e.adj}`:"",h=z[l],I=h&&h.waveId===k.current;return j.jsx("button",{className:[...s,i].join(" "),"aria-label":`Cell ${l}`,onMouseDown:A=>G(A,l),"data-wave":I?h.waveId:void 0,"data-dist":I?h.dist:void 0,children:v},l)})}),j.jsx("div",{className:"ms-footer",children:"Lewy klik odkrywa pole, prawy klik (lub dÅ‚ugie naciÅ›niÄ™cie na touchpadzie) oznacza flagÄ…."})]})}export{re as default};
