import{r as i,j as p}from"./index-UO3WNEwl.js";const s={name:"Gracz",color:"#dc3545",emoji:"🐶",aiColor:"#ffc107",aiEmoji:"💻"},S="app:playerSettings:v1",C="playerSettings";function c(){try{const t=localStorage.getItem(S)??localStorage.getItem(C);if(!t)return s;const o=JSON.parse(t);return E(o)}catch{return s}}function l(t){try{localStorage.setItem(S,JSON.stringify(t))}catch{}}const u=new Set;function x(t){return u.add(t),()=>u.delete(t)}function P(t){for(const o of u)try{o(t)}catch{}}function a(t){const o=c(),e=E({...o,...t});return l(e),P(e),e}function E(t){return{name:d(t?.name)?(""+t.name).slice(0,40):s.name,color:m(t?.color)?g(t.color):s.color,emoji:y(t?.emoji,s.emoji),aiColor:m(t?.aiColor)?g(t.aiColor):s.aiColor,aiEmoji:y(t?.aiEmoji,s.aiEmoji)}}function d(t){return typeof t=="string"&&t.trim().length>0}function m(t){return typeof t=="string"&&/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/.test(t.trim())}function g(t){const o=t.trim();return/^#[0-9a-fA-F]{3}$/.test(o)?"#"+o.slice(1).split("").map(e=>e+e).join("").toLowerCase():o.toLowerCase()}function y(t,o){if(!d(t))return o;const e=(""+t).trim().slice(0,4);return/[<>{}]/.test(e)?o:e}const f=i.createContext(void 0);f.displayName="PlayerSettingsCtx";function h({children:t}){const[o,e]=i.useState(()=>c());i.useEffect(()=>{l(o)},[o]),i.useEffect(()=>x(n=>e(n)),[]),i.useEffect(()=>{const r=n=>{if(n.key&&(n.key.includes("app:playerSettings")||n.key==="playerSettings"))try{e(c())}catch{}};return window.addEventListener("storage",r),()=>window.removeEventListener("storage",r)},[]);const j=i.useMemo(()=>({settings:o,setName:r=>e(n=>a({...n,name:r})),setColor:r=>e(n=>a({...n,color:r})),setEmoji:r=>e(n=>a({...n,emoji:r})),setAiColor:r=>e(n=>a({...n,aiColor:r})),setAiEmoji:r=>e(n=>a({...n,aiEmoji:r})),update:r=>e(n=>a(r)),reset:()=>e(()=>{const r={...s};return l(r),r})}),[o]);return p.jsx(f.Provider,{value:j,children:t})}function v(){const t=i.useContext(f);if(!t)throw new Error("usePlayerSettings must be used within PlayerSettingsProvider");return t}export{h as PlayerSettingsProvider,v as usePlayerSettings};
